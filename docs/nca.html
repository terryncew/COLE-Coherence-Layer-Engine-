<!doctype html><meta charset="utf-8">
<title>NCA × OpenLine — Grow & Heal Receipt</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<script type="module" src="https://cdn.jsdelivr.net/gh/terryncew/openline-core@main/receipts-kit/openline-card.js"></script>
<script type="module">
import * as ed from "https://cdn.jsdelivr.net/npm/@noble/ed25519@1.7.3/+esm";
const pill = (txt, bg) => { const el = document.getElementById("pill"); el.textContent = txt; el.style.background=bg; el.style.color="#fff"; };
const sortObj = (x) => Array.isArray(x) ? x.map(sortObj) : x && typeof x==="object"
  ? Object.keys(x).sort().reduce((o,k)=>(o[k]=sortObj(x[k]),o),{}) : x;
(async () => {
  try {
    const rec = await (await fetch("./receipt.latest.json", {cache:"no-cache"})).json();
    const signer = await (await fetch("./signer.json", {cache:"no-cache"})).json().catch(()=>({}));
    const sig = rec.sig;
    if (!sig || sig.alg!=="Ed25519") { pill("No signature", "#6c757d"); return; }
    if (signer.pub_ed25519 && signer.pub_ed25519.toLowerCase() !== sig.key.toLowerCase()) { pill("Signer mismatch", "#dc3545"); return; }
    const payload = sortObj(Object.fromEntries(Object.entries(rec).filter(([k])=>k!=="sig")));
    const msg = new TextEncoder().encode(JSON.stringify(payload));
    const ok = await ed.verify(sig.value, msg, sig.key);
    pill(ok ? "Verified" : "Invalid", ok ? "#198754" : "#dc3545");
  } catch(e){ pill("Verify error", "#fd7e14"); console.error(e); }
})();
</script>

<h3 style="font-family:system-ui;margin:16px 0">
  NCA × OpenLine — Latest receipt
  <span id="pill" style="margin-left:8px;padding:4px 8px;border-radius:999px;font:12px system-ui;background:#aaa;color:#fff">checking…</span>
</h3>

<openline-card mode="compact" src="./receipt.latest.json"></openline-card>

<p style="font:14px system-ui;color:#666;margin-top:16px">
  Generated in GitHub Actions, signed (Ed25519), and served via GitHub Pages.
  <a href="./index.html">← Back to Hub</a>
</p>
